import{a as ne,b as se,N as A}from"./search-form-B1RalJR2.js";import{d as z,Z as G,r as T,a0 as E,p as re,c as K,o as L,w as n,f as e,h as t,$ as a,ac as ue,ad as ie,au as ce,b as H,a2 as V,as as pe,at as me,g as w,t as j,Y as U,a9 as I,av as Y,aw as Z,ax as de,j as fe,i as be,J as ge,ae as q,ay as he,P as _e,af as J,E as ve,B as C,a6 as ye,_ as ke,az as Be,aA as F,ag as O,ah as we}from"./index-D7NFxYuY.js";import{_ as je,f as Q,a as Se,b as De,c as Ne,d as xe}from"./job-task-list-table.vue_vue_type_script_setup_true_lang-CoCZcJkf.js";import{_ as Re,u as Te,a as $e}from"./table-CAj7pHJG.js";import{f as Je}from"./job-DTe4zTkx.js";import{_ as Ce}from"./select-group.vue_vue_type_script_setup_true_lang-CekkEXat.js";import{_ as Ue}from"./datetime-range.vue_vue_type_script_setup_true_lang-BxcRpL5K.js";import{_ as Ie}from"./AutoComplete-D-tjkyFC.js";import{_ as Le}from"./log-drawer-BMw5kOUe.js";import{_ as Pe}from"./detail-drawer-C6EAU0y5.js";import{_ as Me,a as Ae}from"./DescriptionsItem-CMpwCvJB.js";import{b as Oe}from"./Grid-OaBPjDMI.js";import"./CollapseItem-U_l2MoD9.js";import"./group-BJHuXB4O.js";import"./DatePicker-CdxY6Eo2.js";const Ve=z({name:"JobBatchSearch",__name:"job-batch-search",props:{model:{required:!0},modelModifiers:{}},emits:G(["reset","search"],["update:model"]),setup(g,{emit:y}){const S=T(!1),h=y,d=T([]),u=E(g,"model"),f=T(u.value.jobName);function s(){f.value="",h("reset")}function k(){h("search")}async function m(){const i=await Je({keywords:f.value,groupName:u.value.groupName});d.value=i.data}function D(i){u.value.jobId=i}re(()=>f.value,i=>{i.length!==0?(m(),u.value.jobName=i):(S.value=!1,u.value.jobId=null,u.value.jobName=null)});function N(i){return i.map(r=>({value:r.id,label:r.jobName}))}function R(i){return[i.label,`(${i.value})`]}return(i,r)=>{const _=Re,$=Ie,v=ue,P=ne;return L(),K(P,{"btn-span":"12 s:24 m:10 l:12 xl:16",model:u.value,onSearch:k,onReset:s},{default:n(()=>[e(_,{span:"24 s:12 m:8",label:t(a)("page.jobBatch.groupName"),path:"groupName",class:"pr-24px"},{default:n(()=>[e(Ce,{value:u.value.groupName,"onUpdate:value":r[0]||(r[0]=c=>u.value.groupName=c),clearable:""},null,8,["value"])]),_:1},8,["label"]),e(_,{span:"24 s:12 m:8",label:t(a)("page.jobBatch.jobName"),path:"jobName",class:"pr-24px"},{default:n(()=>[e($,{value:f.value,"onUpdate:value":r[1]||(r[1]=c=>f.value=c),placeholder:t(a)("page.jobBatch.form.jobName"),options:N(d.value),"empty-visible":S.value,clearable:"",filterable:"","render-label":R,onSelect:D},null,8,["value","placeholder","options","empty-visible"])]),_:1},8,["label"]),e(_,{span:"24 s:12 m:8",label:t(a)("page.jobBatch.taskBatchStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:n(()=>[e(v,{value:u.value.taskBatchStatus,"onUpdate:value":r[2]||(r[2]=c=>u.value.taskBatchStatus=c),multiple:"","max-tag-count":"responsive",placeholder:t(a)("common.taskBatchStatus.form"),options:t(ie)(t(ce)).filter(c=>![98,99].includes(c.value)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),e(_,{span:"24 s:24 m:14 l:12 xl:8",label:t(a)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:n(()=>[e(Ue,{value:u.value.datetimeRange,"onUpdate:value":r[3]||(r[3]=c=>u.value.datetimeRange=c)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ze=z({name:"JobBatchDetailDrawer",__name:"job-batch-detail-drawer",props:G({rowData:{default:null},log:{type:Boolean,default:!1}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:["update:visible"],setup(g){const y=g,S=E(g,"visible"),h=T(),d=T(!1);async function u(s){d.value=!0,h.value=s}async function f(){const{error:s}=await Q(y.rowData.id);s||window.$message?.success(a("common.operateSuccess"))}return(s,k)=>{const m=Ae,D=U,N=Me,R=me,i=je,r=pe,_=Pe,$=Le;return L(),H(V,null,[e(_,{modelValue:S.value,"onUpdate:modelValue":k[0]||(k[0]=v=>S.value=v),title:t(a)("page.jobBatch.detail"),width:["50%","90%"]},{default:n(()=>[e(r,{type:"segment",animated:"","default-value":s.log?1:0},{default:n(()=>[e(R,{name:0,tab:t(a)("page.log.info")},{default:n(()=>[e(N,{class:"pt-16px","label-placement":"top",bordered:"",column:2},{default:n(()=>[e(m,{label:t(a)("page.jobBatch.groupName")},{default:n(()=>[w(j(s.rowData?.groupName),1)]),_:1},8,["label"]),e(m,{label:t(a)("page.jobBatch.jobName")},{default:n(()=>[w(j(s.rowData?.jobName),1)]),_:1},8,["label"]),e(m,{label:t(a)("page.jobBatch.taskBatchStatus")},{default:n(()=>[e(D,{type:t(I)(s.rowData?.taskBatchStatus)},{default:n(()=>[w(j(t(a)(t(Y)[s.rowData?.taskBatchStatus])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(m,{label:t(a)("page.jobBatch.executionAt")},{default:n(()=>[w(j(s.rowData?.executionAt),1)]),_:1},8,["label"]),e(m,{label:t(a)("page.jobBatch.operationReason")},{default:n(()=>[e(D,{type:t(I)(s.rowData?.operationReason)},{default:n(()=>[w(j(t(a)(t(Z)[s.rowData?.operationReason])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(m,{label:t(a)("page.jobBatch.executorType")},{default:n(()=>[e(D,{type:t(I)(s.rowData?.executorType)},{default:n(()=>[w(j(t(a)(t(de)[s.rowData?.executorType])),1)]),_:1},8,["type"])]),_:1},8,["label"]),e(m,{label:t(a)("page.jobBatch.executorInfo"),span:2},{default:n(()=>[w(j(s.rowData?.executorInfo),1)]),_:1},8,["label"]),e(m,{label:t(a)("common.createDt"),span:2},{default:n(()=>[w(j(s.rowData?.createDt),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["tab"]),e(R,{name:1,tab:t(a)("page.log.title"),"display-directive":"if"},{default:n(()=>[e(i,{"row-data":s.rowData,onShowLog:u,onRetry:f},null,8,["row-data"])]),_:1},8,["tab"])]),_:1},8,["default-value"])]),_:1},8,["modelValue","title"]),e($,{show:d.value,"onUpdate:show":k[1]||(k[1]=v=>d.value=v),title:t(a)("page.log.title"),"task-data":h.value},null,8,["show","title","task-data"])],64)}}}),qe=fe(ze,[["__scopeId","data-v-f20ef5e0"]]),Fe={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function x(g){return typeof g=="function"||Object.prototype.toString.call(g)==="[object Object]"&&!we(g)}const sa=z({name:"job_batch",__name:"index",setup(g){const y=be(),S=ge(),h=T(),{bool:d,setTrue:u}=q(!1),{bool:f,setBool:s}=q(!1),k=y.query.jobName||"",m=y.query.jobId||"",D=y.query.taskBatchStatus?[Number(y.query.taskBatchStatus)]:[],{columnChecks:N,columns:R,data:i,getData:r,loading:_,mobilePagination:$,searchParams:v,resetSearchParams:P}=Te({apiFn:De,apiParams:{page:1,size:10,groupName:null,jobName:null,taskBatchStatus:null,jobId:null,datetimeRange:he()},searchParams:{jobId:m,jobName:k,taskBatchStatus:D},columns:()=>[{type:"selection",width:30},{key:"id",align:"center",width:100,fixed:"left",title:()=>e("div",{class:"flex-center"},[e("span",null,[a("page.jobBatch.jobTask.id")]),e(ye,{trigger:"hover"},{trigger:()=>e("span",{class:"mb-2px ml-5px text-16px"},[e(ke,{icon:"ant-design:info-circle-outlined"},null)]),default:()=>e("span",null,[a("common.idDetailTip")])})]),render:o=>{function l(){h.value=o,s(!1),u()}return e(C,{text:!0,tag:"a",type:"primary",onClick:l,class:"ws-normal"},{default:()=>[o.id]})}},{key:"groupName",title:a("page.jobBatch.groupName"),align:"left",width:150},{key:"taskType",title:a("page.jobBatch.taskType"),align:"center",width:120,render:o=>{if(o.taskType===null)return null;const l={1:"info",2:"success",3:"error",4:"primary",5:"warning"},B=a(Be[o.taskType]);return e(U,{type:l[o.taskType]},x(B)?B:{default:()=>[B]})}},{key:"jobName",title:a("page.jobBatch.jobName"),align:"center",width:150},{key:"executionAt",title:a("page.jobBatch.executionAt"),align:"center",width:120},{key:"duration",title:a("page.jobBatch.duration"),align:"center",width:120,render:o=>o.taskBatchStatus===3?Math.round(F(o.updateDt).diff(F(o.executionAt))/1e3):null},{key:"taskBatchStatus",title:a("page.jobBatch.taskBatchStatus"),align:"center",width:120,render:o=>{if(o.taskBatchStatus===null)return null;const l=a(Y[o.taskBatchStatus]);return e(U,{type:{1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"}[o.taskBatchStatus]},x(l)?l:{default:()=>[l]})}},{key:"operationReason",title:a("page.jobBatch.operationReason"),align:"center",width:120,render:o=>{if(o.operationReason===null)return null;const l=a(Z[o.operationReason]);return e(U,{type:I(o.operationReason)},x(l)?l:{default:()=>[l]})}},{key:"createDt",title:a("common.createDt"),align:"center",width:120},{key:"operate",title:a("common.operate"),align:"center",width:180,fixed:"right",render:o=>{let l;const B=()=>o.taskBatchStatus===1||o.taskBatchStatus===2?e(V,null,[e(O,{vertical:!0},null),e(A,{onPositiveClick:()=>le(o.id)},{default:()=>a("common.confirmStop"),trigger:()=>{let p;return e(C,{type:"error",text:!0,ghost:!0,size:"small"},x(p=a("common.stop"))?p:{default:()=>[p]})}})]):null,M=()=>o.taskBatchStatus===4||o.taskBatchStatus===5||o.taskBatchStatus===6?e(V,null,[e(O,{vertical:!0},null),e(A,{onPositiveClick:()=>oe(o.id)},{default:()=>a("common.confirmRetry"),trigger:()=>{let p;return e(C,{type:"error",text:!0,ghost:!0,size:"small"},x(p=a("common.retry"))?p:{default:()=>[p]})}})]):null;return e("div",{class:"flex-center gap-8px"},[e(C,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>te(o)},x(l=a("common.log"))?l:{default:()=>[l]}),B(),M(),e(O,{vertical:!0},null),e(A,{onPositiveClick:()=>ee(o.id)},{default:()=>a("common.confirmDelete"),trigger:()=>{let p;return e(C,{type:"error",text:!0,ghost:!0,size:"small"},x(p=a("common.delete"))?p:{default:()=>[p]})}})])}}]}),{checkedRowKeys:c,onDeleted:W,onBatchDeleted:X}=$e(i,r);async function ee(o){const{error:l}=await Ne(o);l||W()}async function ae(){const{error:o}=await Se(c.value);o||X()}function te(o){h.value=o,s(!0),u()}async function oe(o){const{error:l}=await Q(o);l||(window.$message?.success(a("common.operateSuccess")),r())}async function le(o){const{error:l}=await xe(o);l||(window.$message?.success(a("common.operateSuccess")),r())}return(o,l)=>{const B=se,M=Oe,p=ve;return L(),H("div",Fe,[e(Ve,{model:t(v),"onUpdate:model":l[0]||(l[0]=b=>J(v)?v.value=b:null),onReset:t(P),onSearch:t(r)},null,8,["model","onReset","onSearch"]),e(p,{title:t(a)("page.jobBatch.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":n(()=>[e(B,{columns:t(N),"onUpdate:columns":l[1]||(l[1]=b=>J(N)?N.value=b:null),"disabled-delete":t(c).length===0,loading:t(_),"show-add":!1,onDelete:ae,onRefresh:t(r)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:n(()=>[e(M,{"checked-row-keys":t(c),"onUpdate:checkedRowKeys":l[2]||(l[2]=b=>J(c)?c.value=b:null),columns:t(R),data:t(i),"flex-height":!t(S).isMobile,"scroll-x":1200,loading:t(_),remote:"","row-key":b=>b.id,pagination:t($),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"]),t(d)?(L(),K(qe,{key:0,visible:t(d),"onUpdate:visible":l[3]||(l[3]=b=>J(d)?d.value=b:null),log:t(f),"onUpdate:log":l[4]||(l[4]=b=>J(f)?f.value=b:null),"row-data":h.value},null,8,["visible","log","row-data"])):_e("",!0)])}}});export{sa as default};
