import{a as j,b as G,N as P}from"./search-form-B1RalJR2.js";import{d as $,Z as T,a0 as M,c as V,o as U,ac as E,h as o,ad as K,au as H,$ as t,r as W,p as J,w as k,f as a,i as Y,b_ as Z,J as Q,b4 as X,b as ee,af as C,E as ae,B as S,av as te,Y as q,aw as oe,a9 as le,ag as I,a2 as ne,ah as se}from"./index-D7NFxYuY.js";import{f as re,a as ue,b as ce,c as ie,d as me}from"./workflow-CdSuFrSd.js";import{_ as pe,u as de,a as fe}from"./table-CAj7pHJG.js";import{_ as he}from"./select-group.vue_vue_type_script_setup_true_lang-CekkEXat.js";import{_ as we}from"./datetime-range.vue_vue_type_script_setup_true_lang-BxcRpL5K.js";import{_ as ke}from"./AutoComplete-D-tjkyFC.js";import{b as ge}from"./Grid-OaBPjDMI.js";import"./CollapseItem-U_l2MoD9.js";import"./group-BJHuXB4O.js";import"./DatePicker-CdxY6Eo2.js";const _e=$({name:"TaskBatchStatus",__name:"task-batch-status",props:T({disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(m){const c=m,f=M(m,"modelValue");return(_,h)=>{const s=E;return U(),V(s,{value:f.value,"onUpdate:value":h[0]||(h[0]=p=>f.value=p),placeholder:o(t)("common.taskBatchStatus.form"),options:o(K)(o(H)),disabled:c.disabled,clearable:c.clearable},null,8,["value","placeholder","options","disabled","clearable"])}}}),be=$({name:"WorkflowBatchSearch",__name:"workflow-batch-search",props:{model:{required:!0},modelModifiers:{}},emits:T(["reset","search"],["update:model"]),setup(m,{emit:c}){const f=W(!1),_=c,h=W([]),s=M(m,"model"),p=W(s.value.workflowName);function N(){p.value="",_("reset")}function b(){_("search")}async function B(){const n=await re({keywords:p.value,groupName:s.value.groupName});h.value=n.data}function g(n){s.value.workflowId=n}J(()=>p.value,n=>{n.length!==0?B():f.value=!1});function y(n){return n.map(r=>({value:r.id,label:r.workflowName}))}function x(n){return[n.label,`(${n.value})`]}return(n,r)=>{const i=pe,R=ke,D=j;return U(),V(D,{"btn-span":"12 s:24 m:10 l:12 xl:16",model:s.value,onSearch:b,onReset:N},{default:k(()=>[a(i,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.groupName"),path:"groupName",class:"pr-24px"},{default:k(()=>[a(he,{value:s.value.groupName,"onUpdate:value":r[0]||(r[0]=d=>s.value.groupName=d),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(i,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.workflowName"),"label-width":100,path:"workflowName",class:"pr-24px"},{default:k(()=>[a(R,{value:p.value,"onUpdate:value":r[1]||(r[1]=d=>p.value=d),placeholder:o(t)("page.workflowBatch.form.workflowName"),options:y(h.value),"empty-visible":f.value,clearable:"",filterable:"","render-label":x,onSelect:g},null,8,["value","placeholder","options","empty-visible"])]),_:1},8,["label"]),a(i,{span:"24 s:12 m:8",label:o(t)("page.workflowBatch.taskBatchStatus"),path:"taskBatchStatus",class:"pr-24px"},{default:k(()=>[a(_e,{value:s.value.taskBatchStatus,"onUpdate:value":r[2]||(r[2]=d=>s.value.taskBatchStatus=d),clearable:""},null,8,["value"])]),_:1},8,["label"]),a(i,{span:"24 s:24 m:14 l:12 xl:8",label:o(t)("page.common.createTime"),path:"datetimeRange",class:"pr-24px"},{default:k(()=>[a(we,{value:s.value.datetimeRange,"onUpdate:value":r[3]||(r[3]=d=>s.value.datetimeRange=d)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model"])}}}),ve={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function v(m){return typeof m=="function"||Object.prototype.toString.call(m)==="[object Object]"&&!se(m)}const Oe=$({name:"workflow_batch",__name:"index",setup(m){const c=Y(),f=Z(),_=Q(),h=c.query.workflowId?Number(c.query.workflowId):null,s=c.query.workflowName||"",p=c.query.taskBatchStatus?Number(c.query.taskBatchStatus):null,{columns:N,columnChecks:b,data:B,getData:g,loading:y,mobilePagination:x,searchParams:n,resetSearchParams:r}=de({apiFn:ce,apiParams:{page:1,size:10,workflowId:null,workflowName:null,groupName:null,taskBatchStatus:null,datetimeRange:X()},searchParams:{workflowId:h,workflowName:s,taskBatchStatus:p},columns:()=>[{type:"selection"},{key:"id",title:t("common.index"),align:"center",width:120,render:e=>a(S,{text:!0,tag:"a",type:"primary",onClick:()=>O(e.id),class:"ws-normal"},{default:()=>[e.id]})},{key:"workflowName",title:t("page.workflowBatch.workflowName"),align:"center",minWidth:120},{key:"groupName",title:t("page.workflowBatch.groupName"),align:"center",minWidth:120},{key:"executionAt",title:t("page.workflowBatch.executionAt"),align:"center",minWidth:120},{key:"taskBatchStatus",title:t("page.workflowBatch.taskBatchStatus"),align:"center",minWidth:120,render:e=>{if(!e.taskBatchStatus)return null;const l={1:"info",2:"info",3:"info",4:"error",5:"error",6:"error"},u=t(te[e.taskBatchStatus]);return a(q,{type:l[e.taskBatchStatus]},v(u)?u:{default:()=>[u]})}},{key:"operationReason",title:t("page.workflowBatch.operationReason"),align:"center",minWidth:120,render:e=>{if(e.operationReason===null)return null;const l=t(oe[e.operationReason]);return a(q,{type:le(e.operationReason)},v(l)?l:{default:()=>[l]})}},{key:"createDt",title:t("page.workflowBatch.createDt"),align:"center",minWidth:120},{key:"operate",title:t("common.operate"),align:"center",minWidth:130,render:e=>{let l;return a("div",{class:"flex-center gap-8px"},[a(S,{type:"primary",text:!0,ghost:!0,size:"small",onClick:()=>O(e.id)},v(l=t("common.log"))?l:{default:()=>[l]}),a(I,{vertical:!0},null),e?.taskBatchStatus===1||e?.taskBatchStatus===2?a(ne,null,[a(P,{onPositiveClick:()=>F(e.id)},{default:()=>t("common.confirmStop"),trigger:()=>{let u;return a(S,{type:"error",text:!0,ghost:!0,size:"small"},v(u=t("common.stop"))?u:{default:()=>[u]})}}),a(I,{vertical:!0},null)]):null,a(P,{onPositiveClick:()=>d(e.id)},{default:()=>t("common.confirmDelete"),trigger:()=>{let u;return a(S,{type:"error",text:!0,ghost:!0,size:"small"},v(u=t("common.delete"))?u:{default:()=>[u]})}})])}}]}),{checkedRowKeys:i,onDeleted:R,onBatchDeleted:D}=fe(B,g);async function d(e){const{error:l}=await ie(e);l||R()}async function z(){const{error:e}=await ue(i.value);e||D()}async function F(e){const{error:l}=await me(e);l||(window.$message?.success(t("common.executeSuccess")),g())}function O(e){f.push({path:"/workflow/form/batch",query:{id:e}})}return(e,l)=>{const u=G,A=ge,L=ae;return U(),ee("div",ve,[a(be,{model:o(n),"onUpdate:model":l[0]||(l[0]=w=>C(n)?n.value=w:null),onReset:o(r),onSearch:o(g)},null,8,["model","onReset","onSearch"]),a(L,{title:o(t)("page.workflowBatch.title"),bordered:!1,size:"small",class:"card-wrapper sm:flex-1-hidden","header-class":"view-card-header"},{"header-extra":k(()=>[a(u,{columns:o(b),"onUpdate:columns":l[1]||(l[1]=w=>C(b)?b.value=w:null),"disabled-delete":o(i).length===0,loading:o(y),"show-add":!1,onDelete:z,onRefresh:o(g)},null,8,["columns","disabled-delete","loading","onRefresh"])]),default:k(()=>[a(A,{"checked-row-keys":o(i),"onUpdate:checkedRowKeys":l[2]||(l[2]=w=>C(i)?i.value=w:null),columns:o(N),data:o(B),"flex-height":!o(_).isMobile,"scroll-x":962,loading:o(y),remote:"","row-key":w=>w.id,pagination:o(x),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"])]),_:1},8,["title"])])}}});export{Oe as default};
